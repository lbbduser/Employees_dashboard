<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Employee Dashboard Premium</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      color: #f0f4f8;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      max-width: 480px;
      width: 100%;
      background: #1a202c;
      border-radius: 1rem;
      padding: 2.5rem 2rem 3rem;
      box-shadow: 0 15px 40px rgba(0,0,0,0.7);
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    h2 {
      font-weight: 800;
      font-size: 2.6rem;
      margin-bottom: 1.5rem;
      letter-spacing: 0.06em;
      text-shadow: 0 2px 8px rgba(102,126,234,0.9);
      color: #a0aec0;
      user-select: none;
    }
    input {
      background: #2d3748;
      border: none;
      padding: 1.15rem 1.5rem;
      border-radius: 1rem;
      color: #e2e8f0;
      font-size: 1.15rem;
      width: 100%;
      margin-bottom: 1.6rem;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.8);
      transition: background-color 0.3s, box-shadow 0.3s;
      font-weight: 600;
      letter-spacing: 0.02em;
      user-select: text;
    }
    input::placeholder {
      color: #718096;
      font-weight: 500;
    }
    input:focus {
      outline: none;
      background: #4a5568;
      box-shadow: 0 0 14px 3px #667eea;
      color: #f7fafc;
    }
    button {
      background: #667eea;
      padding: 1.15rem 1rem;
      border-radius: 1.7rem;
      font-weight: 800;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.35s, box-shadow 0.35s;
      color: #fff;
      font-size: 1.25rem;
      box-shadow: 0 10px 28px rgba(102,126,234,0.9);
      user-select: none;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: 1.5rem;
    }
    button:hover {
      background: #5a67d8;
      box-shadow: 0 14px 40px rgba(102,126,234,1);
    }
    .switch-login {
      font-size: 1rem;
      user-select: none;
      color: #94a3b8;
      margin-bottom: 2rem;
    }
    .switch-login button {
      background: none;
      border: none;
      color: #667eea;
      font-weight: 700;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
      margin-left: 6px;
      font-size: 1rem;
      user-select: text;
    }
    .switch-login button:hover {
      color: #a3bffa;
    }
    /* Fade animation */
    .hidden {
      display: none !important;
    }
    .fadeInUp {
      animation-duration: 0.55s;
      animation-fill-mode: both;
      animation-name: fadeInUp;
    }
    @keyframes fadeInUp {
      from {opacity: 0; transform: translateY(30px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* Dashboard nav and content styles */
    #dashboardNav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    #dashboardNav button {
      flex: 1;
      padding: 0.8rem 0;
      border-radius: 1rem;
      font-weight: 700;
      font-size: 1.1rem;
      background: #4c51bf;
      color: #e2e8f0;
      box-shadow: 0 6px 20px rgba(76,81,191,0.6);
      transition: background-color 0.35s;
      cursor: pointer;
      user-select: none;
    }
    #dashboardNav button:hover, #dashboardNav button.active {
      background: #667eea;
      box-shadow: 0 12px 32px rgba(102,126,234,0.9);
      color: white;
    }
    .pageContent {
      background: #2d3748;
      border-radius: 1rem;
      padding: 1.5rem 1.5rem 2rem;
      color: #e2e8f0;
      min-height: 320px;
      overflow-y: auto;
      box-shadow: inset 0 0 14px rgba(0,0,0,0.9);
      user-select: text;
      font-size: 1rem;
      line-height: 1.5;
    }

    /* Scrollbar for pageContent */
    .pageContent::-webkit-scrollbar {
      width: 8px;
    }
    .pageContent::-webkit-scrollbar-track {
      background: #1a202c;
      border-radius: 1rem;
    }
    .pageContent::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 1rem;
    }
  </style>
</head>
<body>
  <div class="container" id="loginContainer">

    <!-- LOGIN PAGES -->
    <div id="adminLoginPage" class="fadeInUp hidden">
      <h2>Admin Login</h2>
      <input type="text" id="adminUser" placeholder="Admin Username" autocomplete="off" />
      <input type="password" id="adminPass" placeholder="Admin Password" autocomplete="off" />
      <button onclick="adminLogin()">Login as Admin</button>
      <div class="switch-login">
        Not admin? 
        <button onclick="showLoginPage('user')">User Login</button>
      </div>
    </div>

    <div id="userLoginPage" class="fadeInUp">
      <h2>User Login</h2>
      <input type="text" id="userName" placeholder="Username" autocomplete="off" />
      <input type="text" id="userKey" placeholder="User Key" autocomplete="off" />
      <button onclick="userLogin()">Login as User</button>
      <div class="switch-login">
        Are you admin? 
        <button onclick="showLoginPage('admin')">Admin Login</button>
      </div>
    </div>
  </div>

  <!-- DASHBOARD CONTAINER (hidden initially) -->
  <div class="container hidden" id="dashboardContainer" style="max-width: 620px; flex-direction: column;">
    <h2 id="dashboardWelcome" style="user-select:none; margin-bottom: 1.5rem;"></h2>
    <nav id="dashboardNav" aria-label="Dashboard navigation">
      <button data-page="reports" class="active" aria-current="page">Reports</button>
      <button data-page="payments">Payments</button>
      <button data-page="notices">Notices</button>
      <button id="logoutBtn" style="background:#e53e3e;">Logout</button>
    </nav>
    <section id="dashboardContent" class="pageContent" tabindex="0" aria-live="polite" aria-atomic="true">
      Loading...
    </section>
  </div>

<script>
  // Firebase config - your project config here
  const firebaseConfig = {
    apiKey: "AIzaSyBImNhuhq_k4XrVLXmOxOxbN4sNQhMd5PI",
    authDomain: "employeedashboard-ab719.firebaseapp.com",
    projectId: "employeedashboard-ab719",
    storageBucket: "employeedashboard-ab719.appspot.com",
    messagingSenderId: "522230234787",
    appId: "1:522230234787:web:3330149914737352b68916"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Page Elements
  const adminLoginPage = document.getElementById('adminLoginPage');
  const userLoginPage = document.getElementById('userLoginPage');
  const loginContainer = document.getElementById('loginContainer');
  const dashboardContainer = document.getElementById('dashboardContainer');
  const dashboardWelcome = document.getElementById('dashboardWelcome');
  const dashboardNav = document.getElementById('dashboardNav');
  const dashboardContent = document.getElementById('dashboardContent');
  const logoutBtn = document.getElementById('logoutBtn');

  let currentUser = null;
  let currentRole = null; // 'admin' or 'user'

  // Show login page: "admin" or "user"
  function showLoginPage(type) {
    if (type === 'admin') {
      adminLoginPage.classList.remove('hidden');
      userLoginPage.classList.add('hidden');
    } else {
      adminLoginPage.classList.add('hidden');
      userLoginPage.classList.remove('hidden');
    }
  }

  // Admin login
  async function adminLogin() {
    const username = document.getElementById('adminUser').value.trim();
    const password = document.getElementById('adminPass').value.trim();
    if (!username || !password) {
      Swal.fire('Error', 'Please enter admin username and password', 'error');
      return;
    }

    try {
      const adminDoc = await db.collection('admins').doc(username).get();
      if (!adminDoc.exists) {
        Swal.fire('Error', 'Admin username not found', 'error');
        return;
      }
      const adminData = adminDoc.data();
      if (adminData.password !== password) {
        Swal.fire('Error', 'Wrong password', 'error');
        return;
      }
      currentUser = username;
      currentRole = 'admin';
      Swal.fire('Success', 'Logged in as Admin', 'success');
      showDashboard();
    } catch (e) {
      console.error(e);
      Swal.fire('Error', 'Failed to login admin', 'error');
    }
  }

  // User login
  async function userLogin() {
    const username = document.getElementById('userName').value.trim();
    const key = document.getElementById('userKey').value.trim();
    if (!username || !key) {
      Swal.fire('Error', 'Please enter username and key', 'error');
      return;
    }

    try {
      const userDoc = await db.collection('users').doc(username).get();
      if (!userDoc.exists) {
        Swal.fire('Error', 'User not found', 'error');
        return;
      }
      const userData = userDoc.data();
      if (userData.key !== key) {
        Swal.fire('Error', 'Wrong key', 'error');
        return;
      }
      currentUser = username;
      currentRole = 'user';
      Swal.fire('Success', 'Logged in as User', 'success');
      showDashboard();
    } catch (e) {
      console.error(e);
      Swal.fire('Error', 'Failed to login user', 'error');
    }
  }

  // Show dashboard and load default page
  function showDashboard() {
    loginContainer.classList.add('hidden');
    dashboardContainer.classList.remove('hidden');
    dashboardWelcome.textContent = `Welcome, ${currentUser} (${currentRole.toUpperCase()})`;
    loadPage('reports'); // default page
  }

  // Logout function
  logoutBtn.addEventListener('click', () => {
    Swal.fire({
      title: 'Logout?',
      text: 'Are you sure you want to logout?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Yes, logout',
      cancelButtonText: 'Cancel',
    }).then(result => {
      if(result.isConfirmed) {
        currentUser = null;
        currentRole = null;
        dashboardContainer.classList.add('hidden');
        loginContainer.classList.remove('hidden');
        showLoginPage('user');
      }
    });
  });

  // Dashboard navigation button click handler
  dashboardNav.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON' && e.target.dataset.page) {
      const page = e.target.dataset.page;
      setActiveNav(page);
      loadPage(page);
    }
  });

  // Set active button in dashboard nav
  function setActiveNav(page) {
    [...dashboardNav.querySelectorAll('button')].forEach(btn => {
      if(btn.dataset.page === page) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }

  // Load content for each page
  async function loadPage(page) {
    dashboardContent.innerHTML = '<p class="text-center text-gray-300">Loading...</p>';
    try {
      if(page === 'reports') {
        await loadReports();
      } else if(page === 'payments') {
        await loadPayments();
      } else if(page === 'notices') {
        await loadNotices();
      }
    } catch(e) {
      dashboardContent.innerHTML = `<p class="text-red-500 text-center">Error loading ${page}</p>`;
      console.error(e);
    }
  }

  // Load Reports page data
  async function loadReports() {
    // Admin can see all, users only their own
    let query;
    if(currentRole === 'admin') {
      query = db.collection('reports').orderBy('date', 'desc').limit(30);
    } else {
      query = db.collection('reports').where('employee', '==', currentUser).orderBy('date', 'desc').limit(30);
    }
    const snapshot = await query.get();
    if(snapshot.empty) {
      dashboardContent.innerHTML = '<p class="text-center text-gray-400">No reports found.</p>';
      return;
    }
    let html = '<h3 class="text-xl font-semibold mb-3">Reports</h3><ul class="space-y-3">';
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `
        <li class="p-3 rounded bg-gray-700">
          <strong>Date:</strong> ${data.date}<br />
          <strong>Employee:</strong> ${data.employee}<br />
          <strong>Message:</strong> ${data.message}<br />
          ${data.fileUrl ? `<a href="${data.fileUrl}" target="_blank" class="text-blue-400 underline">View File</a>` : ''}
        </li>
      `;
    });
    html += '</ul>';
    // Admin add report button
    if(currentRole === 'admin') {
      html += `<button class="mt-6 bg-green-500 hover:bg-green-600 rounded px-4 py-2 font-semibold" onclick="showAddReport()">Add Report</button>`;
    }
    dashboardContent.innerHTML = html;
  }

  // Load Payments page data
  async function loadPayments() {
    let query;
    if(currentRole === 'admin') {
      query = db.collection('payments').orderBy('date', 'desc').limit(30);
    } else {
      query = db.collection('payments').where('employee', '==', currentUser).orderBy('date', 'desc').limit(30);
    }
    const snapshot = await query.get();
    if(snapshot.empty) {
      dashboardContent.innerHTML = '<p class="text-center text-gray-400">No payments found.</p>';
      return;
    }
    let html = '<h3 class="text-xl font-semibold mb-3">Payments</h3><ul class="space-y-3">';
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `
        <li class="p-3 rounded bg-gray-700">
          <strong>Date:</strong> ${data.date}<br />
          <strong>Employee:</strong> ${data.employee}<br />
          <strong>Amount:</strong> ${data.amount}<br />
          <strong>Note:</strong> ${data.note || 'N/A'}<br />
          <strong>Message:</strong> ${data.message || 'N/A'}
        </li>
      `;
    });
    html += '</ul>';
    // Admin add payment button
    if(currentRole === 'admin') {
      html += `<button class="mt-6 bg-green-500 hover:bg-green-600 rounded px-4 py-2 font-semibold" onclick="showAddPayment()">Add Payment</button>`;
    }
    dashboardContent.innerHTML = html;
  }

  // Load Notices page data
  async function loadNotices() {
    const snapshot = await db.collection('notices').orderBy('date', 'desc').limit(30).get();
    if(snapshot.empty) {
      dashboardContent.innerHTML = '<p class="text-center text-gray-400">No notices found.</p>';
      return;
    }
    let html = '<h3 class="text-xl font-semibold mb-3">Notices</h3><ul class="space-y-3">';
    snapshot.forEach(doc => {
      const data = doc.data();
      html += `
        <li class="p-3 rounded bg-gray-700">
          <strong>Date:</strong> ${data.date}<br />
          <strong>Message:</strong> ${data.message}
        </li>
      `;
    });
    html += '</ul>';
    // Admin add notice button
    if(currentRole === 'admin') {
      html += `<button class="mt-6 bg-green-500 hover:bg-green-600 rounded px-4 py-2 font-semibold" onclick="showAddNotice()">Add Notice</button>`;
    }
    dashboardContent.innerHTML = html;
  }

  // Show Add Report modal/popup for admin
  function showAddReport() {
    Swal.fire({
      title: 'Add New Report',
      html:
        `<input id="swal-report-employee" class="swal2-input" placeholder="Employee Username" autocomplete="off">` +
        `<input id="swal-report-date" class="swal2-input" placeholder="Date (YYYY-MM-DD)" autocomplete="off" type="date">` +
        `<textarea id="swal-report-message" class="swal2-textarea" placeholder="Report message"></textarea>` +
        `<input id="swal-report-file" class="swal2-input" placeholder="File URL (optional)" autocomplete="off">`,
      focusConfirm: false,
      preConfirm: () => {
        const employee = document.getElementById('swal-report-employee').value.trim();
        const date = document.getElementById('swal-report-date').value.trim();
        const message = document.getElementById('swal-report-message').value.trim();
        const fileUrl = document.getElementById('swal-report-file').value.trim();
        if (!employee || !date || !message) {
          Swal.showValidationMessage('Please enter employee, date, and message');
          return false;
        }
        return { employee, date, message, fileUrl };
      }
    }).then(async (result) => {
      if(result.isConfirmed) {
        const { employee, date, message, fileUrl } = result.value;
        try {
          await db.collection('reports').add({ employee, date, message, fileUrl });
          Swal.fire('Success', 'Report added', 'success');
          loadPage('reports');
        } catch (e) {
          Swal.fire('Error', 'Failed to add report', 'error');
          console.error(e);
        }
      }
    });
  }

  // Show Add Payment modal/popup for admin
  function showAddPayment() {
    Swal.fire({
      title: 'Add New Payment',
      html:
        `<input id="swal-payment-employee" class="swal2-input" placeholder="Employee Username" autocomplete="off">` +
        `<input id="swal-payment-date" class="swal2-input" placeholder="Date (YYYY-MM-DD)" autocomplete="off" type="date">` +
        `<input id="swal-payment-amount" class="swal2-input" placeholder="Amount" autocomplete="off" type="number" min="0" step="any">` +
        `<input id="swal-payment-note" class="swal2-input" placeholder="Note (optional)" autocomplete="off">` +
        `<textarea id="swal-payment-message" class="swal2-textarea" placeholder="Message (optional)"></textarea>`,
      focusConfirm: false,
      preConfirm: () => {
        const employee = document.getElementById('swal-payment-employee').value.trim();
        const date = document.getElementById('swal-payment-date').value.trim();
        const amount = document.getElementById('swal-payment-amount').value.trim();
        const note = document.getElementById('swal-payment-note').value.trim();
        const message = document.getElementById('swal-payment-message').value.trim();
        if (!employee || !date || !amount) {
          Swal.showValidationMessage('Please enter employee, date, and amount');
          return false;
        }
        return { employee, date, amount, note, message };
      }
    }).then(async (result) => {
      if(result.isConfirmed) {
        const { employee, date, amount, note, message } = result.value;
        try {
          await db.collection('payments').add({ employee, date, amount, note, message });
          Swal.fire('Success', 'Payment added', 'success');
          loadPage('payments');
        } catch (e) {
          Swal.fire('Error', 'Failed to add payment', 'error');
          console.error(e);
        }
      }
    });
  }

  // Show Add Notice modal/popup for admin
  function showAddNotice() {
    Swal.fire({
      title: 'Add New Notice',
      html:
        `<input id="swal-notice-date" class="swal2-input" placeholder="Date (YYYY-MM-DD)" autocomplete="off" type="date">` +
        `<textarea id="swal-notice-message" class="swal2-textarea" placeholder="Notice message"></textarea>`,
      focusConfirm: false,
      preConfirm: () => {
        const date = document.getElementById('swal-notice-date').value.trim();
        const message = document.getElementById('swal-notice-message').value.trim();
        if (!date || !message) {
          Swal.showValidationMessage('Please enter date and message');
          return false;
        }
        return { date, message };
      }
    }).then(async (result) => {
      if(result.isConfirmed) {
        const { date, message } = result.value;
        try {
          await db.collection('notices').add({ date, message });
          Swal.fire('Success', 'Notice added', 'success');
          loadPage('notices');
        } catch (e) {
          Swal.fire('Error', 'Failed to add notice', 'error');
          console.error(e);
        }
      }
    });
  }

  // Show user login page initially
  showLoginPage('user');
</script>
</body>
</html>
